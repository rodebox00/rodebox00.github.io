---
layout: post
title: Fileless Malware
---

En la actualidad existen diversos tipos de malware, tales como rootkits, gusanos, ransomwares, etc. Un modelo menos conocido pero no por ello menos peligroso es el fileless malware. Como particularidad, a diferencia de los demás, el código del mismo no se encuentra en el disco del sistema sino que se carga directamente en memoria. 

En este artículo se explica en que consiste este tipo de malware y cuales son sus características principales. De forma más técnica, se simula un escenario real donde se crea un fileless malware que se emplea para infectar una máquina Windows 10. La carga en memoria del código y la persistencia en el sistema vendrá apoyada por un programa legítimo modificado. Adicionalmente se detallarán un conjunto de contramedidas para prevenir y detectar este tipo de código malicioso. 

### ¿Qué es el fileless malware?

El fileless malware es un tipo concreto de malware cuyo código no se encuentra en un fichero dentro del equipo, sino en memoria RAM. Esto conlleva que el malware sea muy volátil, es decir, al apagar el equipo este se elimina. Es por ello que normalmente se apoya en un código externo que lo cargar en memoria desde una fuente remota. Este código de carga suele estar embebido en un programa o fichero manipulado. Para este último caso, en sistemas Windows una práctica frecuente es la de insertar código en archivos de office usando macros. Una vez en ejecución, el malware intenta lograr persistencia, es decir, que el código de carga se ejecute cada vez que se inicia el sistema. Debido a esto, se suelen crear tareas periódicas o servicios que usen este código y descarguen la pieza de malware en cada inicio del sistema. En el caso particular de Windows, también se crean claves de registro o se realiza el [secuestro en el orden de búsqueda de DLLs](https://learn.microsoft.com/en-gb/windows/win32/dlls/dynamic-link-library-search-order?redirectedfrom=MSDN). Cabe destacar que en algunos escenarios como la presencia del backdoor [DoublePulsar](https://www.morphisec.com/hubfs/wp-content/uploads/2017/11/Fileless-Malware_Attack-Trend-Exposed.pdf), se puede prescindir del código externo e inyectar el malware directamente en memoria mediante paquetes de red.

Por el contrario, el sistema víctima debe poder acceder a la fuente remota que proporciona el código correspondiente al malware. Es por ello que ante un sistema sin conexión con determinada red, el ataque no tendría éxito. De igual manera se obtendría el mismo resultado si se hiciera uso de un firewall que no permitiera la conexión al servidor remoto.

Una característica del fileless malware es que al no estar contenido en ningún archivo y ejecutarse en memoria, no es detectado por la mayoría de antivirus como [código malicioso](https://ieeexplore.ieee.org/document/8768769). De esta forma evade técnicas de detección como las basadas en firma o heurística. La no detección en memoria por parte de los antivirus se debe a que el análisis de comportamiento en memoria es muy costo en términos de recursos del sistema. Además, en una situación de post-ataque, la previa ejecución en memoria dificulta la acción de encontrar evidencias forenses.

Generalmente, el fileless malware utiliza herramientas legítimas del sistema con fines maliciosos, esta técnica es conocida como *living off the land*. En sistemas Windows, es común utilizar herramientas como  *powershell* o *Windows Management Instrumentation (WMI)*. Por el contrario, en sistemas GNU/Linux se suele hacer uso de la llamada al sistema [*ptrace()*](http://archive.hack.lu/2019/Fileless-Malware-Infection-and-Linux-Process-Injection-in-Linux-OS.pdf) que bloquea un proceso. Así mismo, también se emplea la llamada al sistema [*memfd\_create()*](https://magisterquis.github.io/2018/03/31/in-memory-only-elf-execution.html) que permite crear un archivo anónimo almacenado en memoria. El uso de estas herramientas añade aún más dificultad en la detección.
